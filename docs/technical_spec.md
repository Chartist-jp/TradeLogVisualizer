# トレード分析アプリ『TradeLog Visualizer』システム・詳細設計書

## 1. システム目的・背景
投資家が自身の過去トレード（SBI証券）を視覚化し、チャートパターンから「勝ち・負け」の要因を分析できる環境を提供する。

## 2. 非機能要件・インフラ
* **パフォーマンス**: 複数チャート（6枚）の同時表示においてメモリ消費を抑え、スクロールをスムーズにする。
* **データ保護**: ユーザーデータは暗号化し、資産額を隠す「マスキングモード」を搭載する。
* **可用性**: バックアップの自動実行（日次）。
* **稼働環境**: 初期はローカルPCでngrokを使用して公開。将来的にDockerを用いてクラウド（AWS等）へ移行。

## 3. データベース設計（スキーマ案）

### 3.1. テーブル構成
1.  **Users**: ユーザー管理
2.  **Symbols**: 銘柄マスタ（Ticker, Country, Name, Market）
3.  **StockPrices**: 日足時系列データ（Symbol_id, Date, OHLCV）
4.  **TradeLogs**: SBI証券インポートデータ
5.  **AnalysisGroups**: 分析・グループ化情報

### 3.2. データ処理ロジック
* **SBI CSVパース**: 日本株CSV（コード独立型）と米国株CSV（銘柄名にティッカー混在型）を正規表現で統一的に解析する。
* **集計処理**: DBには「日足」だけを持ち、週足・月足はフロントエンド側で動的に計算する。

## 4. 可視化・分析機能詳細

### 4.1. トレード単位への統合ロジック
約定(Execution)データを、分析可能な「トレード(Trade)」単位に変換する。
* **グループ化**: 銘柄コードでグループ化。
* **マッチング**: 時系列順に買いと売りのペアを作る。
* **計算項目**:
    * 平均取得単価
    * 平均売却単価
    * 損益額 (P/L)
    * 利益率 (ROI)
    * 保有期間

### 4.2. 分析・並び替え候補（AnalysisGroups）
以下の軸で表示順序を動的に変更する。
1.  **パフォーマンス順**: 利益率・損益実額の順
2.  **保有期間順**: 短期/中長期フィルタ
3.  **カレンダーアノマリー**: 曜日別、月別の勝率
4.  **銘柄属性別**: 日本株/米国株別、価格帯別
5.  **タグ・手動グループ**: ユーザーによる「勝ちパターン」タグ付け

### 4.3. UI/UX仕様
* **チャートグループUI**: ドラッグ＆ドロップで並び替え可能。上部に損益合計、勝率を表示。
* **チャート詳細表示**:
  - 移動平均線（SMA）は線のみを表示し、価格スケールには価格を表示させない。
  - チャート上の売買マーカー（Buy/Sell）には、取得額・売却額を通貨単位（¥/$）付きで表示する。
* **分析一覧パネル**: 全トレードリスト。クリックで該当期間へフォーカス。

---